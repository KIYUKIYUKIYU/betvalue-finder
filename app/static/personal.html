<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BetValue Finder - Personal Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'JetBrains Mono', 'Consolas', monospace;
            background: #0d1117;
            color: #c9d1d9;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1f2937, #0f172a);
            border-radius: 12px;
            border: 1px solid #30363d;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #2563eb, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #8b949e;
            font-size: 1.1rem;
        }

        .form-section {
            background: #161b22;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #30363d;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .form-section h2 {
            margin-bottom: 15px;
            color: #f0f6fc;
            font-size: 1.3rem;
            border-bottom: 1px solid #21262d;
            padding-bottom: 8px;
        }

        textarea {
            width: 100%;
            height: 180px;
            background: #0d1117;
            color: #c9d1d9;
            border: 1px solid #30363d;
            padding: 15px;
            font-family: inherit;
            border-radius: 6px;
            resize: vertical;
            font-size: 14px;
            transition: border-color 0.2s ease;
        }

        textarea:focus {
            outline: none;
            border-color: #1f6feb;
            box-shadow: 0 0 0 2px rgba(31, 111, 235, 0.3);
        }

        .button-group {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            background: #238636;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background: #2ea043;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(46, 160, 67, 0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-secondary {
            background: #6e7681;
        }

        .btn-secondary:hover {
            background: #7c8287;
        }

        .btn-info {
            background: #1f6feb;
        }

        .btn-info:hover {
            background: #4184f3;
        }

        .results {
            margin-top: 20px;
        }

        .results-summary {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .results-summary h3 {
            color: #f0f6fc;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }

        .game-card {
            background: #161b22;
            border: 1px solid #30363d;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .game-card:hover {
            border-color: #1f6feb;
            box-shadow: 0 4px 12px rgba(31, 111, 235, 0.2);
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .game-teams {
            font-size: 1.2rem;
            font-weight: bold;
            color: #f0f6fc;
        }

        .vs {
            color: #8b949e;
            margin: 0 10px;
            font-weight: normal;
        }

        .sport-badge {
            background: #1f6feb;
            color: white;
            padding: 4px 12px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .game-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .detail-label {
            color: #8b949e;
            font-size: 13px;
        }

        .detail-value {
            font-weight: bold;
            color: #f0f6fc;
        }

        .ev-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #0d1117;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .ev-value {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .ev-positive {
            color: #2ea043;
        }

        .ev-negative {
            color: #f85149;
        }

        .ev-neutral {
            color: #8b949e;
        }

        .verdict {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
        }

        .verdict-strong {
            background: rgba(247, 144, 9, 0.2);
            color: #f79000;
            border: 1px solid #f79000;
        }

        .verdict-bet {
            background: rgba(46, 160, 67, 0.2);
            color: #2ea043;
            border: 1px solid #2ea043;
        }

        .verdict-consider {
            background: rgba(31, 111, 235, 0.2);
            color: #4184f3;
            border: 1px solid #4184f3;
        }

        .verdict-avoid {
            background: rgba(248, 81, 73, 0.2);
            color: #f85149;
            border: 1px solid #f85149;
        }

        .verdict-neutral {
            background: rgba(139, 148, 158, 0.2);
            color: #8b949e;
            border: 1px solid #8b949e;
        }

        .confidence-section {
            margin-bottom: 15px;
        }

        .confidence-bar {
            width: 100%;
            height: 6px;
            background: #21262d;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 5px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #f85149, #f79000, #2ea043);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .confidence-text {
            font-size: 12px;
            color: #8b949e;
        }

        .json-view {
            background: #0d1117;
            border: 1px solid #30363d;
            padding: 15px;
            border-radius: 6px;
            font-size: 11px;
            overflow-x: auto;
            white-space: pre-wrap;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
        }

        .debug-info {
            margin-top: 15px;
            color: #8b949e;
            border-top: 1px solid #21262d;
            padding-top: 15px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #8b949e;
        }

        .loading::after {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #30363d;
            border-top-color: #1f6feb;
            border-radius: 50%;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            color: #f85149;
            background: rgba(248, 81, 73, 0.1);
            padding: 15px;
            border-radius: 6px;
            border: 1px solid rgba(248, 81, 73, 0.3);
            margin: 15px 0;
        }

        .api-id {
            font-size: 11px;
            color: #6e7681;
            margin-top: 10px;
            font-family: 'JetBrains Mono', monospace;
        }

        .shortcut-info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #161b22;
            border: 1px solid #30363d;
            padding: 10px;
            border-radius: 6px;
            font-size: 11px;
            color: #8b949e;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .game-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .ev-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .results-summary {
                flex-direction: column;
                align-items: flex-start;
            }

            .shortcut-info {
                display: none;
            }
        }

        /* è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
        .settings-section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .settings-section h3 {
            margin-bottom: 15px;
            color: #f0f6fc;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 15px;
        }

        .setting-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .setting-item label {
            font-size: 0.9rem;
            color: #8b949e;
            font-weight: 500;
        }

        .setting-item input, .setting-item select {
            background: #0d1117;
            border: 1px solid #30363d;
            border-radius: 6px;
            padding: 8px 12px;
            color: #c9d1d9;
            font-family: inherit;
        }

        .setting-item input:focus, .setting-item select:focus {
            outline: none;
            border-color: #1f6feb;
            box-shadow: 0 0 0 3px rgba(31, 111, 235, 0.3);
        }

        /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ */
        .progress-section {
            background: #161b22;
            border: 1px solid #30363d;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            display: none;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #21262d;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #1f6feb, #10b981);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-stages {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #8b949e;
            margin-bottom: 10px;
        }

        .stage-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .stage-item.active {
            color: #1f6feb;
        }

        .stage-item.completed {
            color: #10b981;
        }

        .progress-details {
            font-size: 0.9rem;
            color: #8b949e;
            text-align: center;
        }

        /* åŒæ–¹å‘ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°åˆ†æã‚¹ã‚¿ã‚¤ãƒ« */
        .betting-analysis {
            margin-top: 15px;
        }

        .team-betting-section {
            border: 1px solid #30363d;
            transition: all 0.2s ease;
        }

        .team-betting-section:hover {
            border-color: #1f6feb;
            box-shadow: 0 2px 8px rgba(31, 111, 235, 0.15);
        }

        .odds-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            padding: 8px;
            background: #161b22;
            border-radius: 4px;
            border: 1px solid #21262d;
        }

        @media (max-width: 768px) {
            .settings-grid {
                grid-template-columns: 1fr;
            }

            .progress-stages {
                flex-wrap: wrap;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>ğŸ¯ BetValue Finder</h1>
            <p>Personal Edition - é–‹ç™ºè€…ãƒ»å‹äººå‘ã‘ç„¡åˆ¶é™ã‚¢ã‚¯ã‚»ã‚¹ç‰ˆ</p>
        </header>

        <!-- è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section class="settings-section">
            <h3>âš™ï¸ åˆ†æè¨­å®š</h3>
            <div class="settings-grid">
                <div class="setting-item">
                    <label for="jpOdds">æ—¥æœ¬å¼é…å½“å€ç‡</label>
                    <select id="jpOdds">
                        <option value="1.85">1.85å€</option>
                        <option value="1.9" selected>1.9å€ (æ¨™æº–)</option>
                        <option value="1.95">1.95å€</option>
                        <option value="2.0">2.0å€</option>
                    </select>
                </div>
                <div class="setting-item">
                    <label for="rakeback">ãƒ¬ãƒ¼ã‚­ãƒãƒƒã‚¯ç‡ (%)</label>
                    <select id="rakeback">
                        <option value="0.0" selected>0.0% (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)</option>
                        <option value="0.005">0.5%</option>
                        <option value="0.01">1.0%</option>
                        <option value="0.015">1.5%</option>
                        <option value="0.02">2.0%</option>
                        <option value="0.025">2.5%</option>
                        <option value="0.03">3.0% (æœ€å¤§)</option>
                    </select>
                </div>
            </div>
            <div style="font-size: 0.85rem; color: #8b949e; margin-top: 10px;">
                ğŸ’¡ ãƒ¬ãƒ¼ã‚­ãƒãƒƒã‚¯åŠ¹æœ: æœ€çµ‚EV = åŸºæœ¬EV + (ãƒ¬ãƒ¼ã‚­ãƒãƒƒã‚¯ç‡ Ã— æ—¥æœ¬å¼é…å½“) Ã— 100
            </div>
        </section>

        <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <section id="progressSection" class="progress-section">
            <h3>ğŸ”„ Pipeline Orchestrator ã§åˆ†æä¸­...</h3>
            <div class="progress-bar">
                <div id="progressFill" class="progress-fill"></div>
            </div>
            <div class="progress-stages">
                <div class="stage-item" id="stage-parsing">
                    <span>ğŸ”</span>
                    <span>ãƒ‘ãƒ¼ã‚¹ä¸­...</span>
                </div>
                <div class="stage-item" id="stage-api">
                    <span>ğŸŒ</span>
                    <span>APIå–å¾—ä¸­...</span>
                </div>
                <div class="stage-item" id="stage-matching">
                    <span>ğŸ¯</span>
                    <span>ãƒãƒƒãƒãƒ³ã‚°ä¸­...</span>
                </div>
                <div class="stage-item" id="stage-odds">
                    <span>ğŸ’°</span>
                    <span>ã‚ªãƒƒã‚ºå–å¾—ä¸­...</span>
                </div>
                <div class="stage-item" id="stage-ev">
                    <span>ğŸ§®</span>
                    <span>EVè¨ˆç®—ä¸­...</span>
                </div>
                <div class="stage-item" id="stage-final">
                    <span>ğŸ“‹</span>
                    <span>æœ€çµ‚åŒ–ä¸­...</span>
                </div>
            </div>
            <div id="progressDetails" class="progress-details">
                åˆ†æã‚’æº–å‚™ã—ã¦ã„ã¾ã™...
            </div>
        </section>

        <section class="form-section">
            <h2>ğŸ“ ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°åˆ†æ</h2>
            <textarea
                id="bettingText"
                placeholder="ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„...

ä¾‹:
[ï¼­ï¼¬ï¼¢] ãƒ¤ãƒ³ã‚­ãƒ¼ã‚¹<2.0> ãƒ›ãƒ¯ã‚¤ãƒˆã‚½ãƒƒã‚¯ã‚¹
[ï¼­ï¼¬ï¼¢] ãƒ‰ã‚¸ãƒ£ãƒ¼ã‚¹<1.5> ãƒ‘ãƒ‰ãƒ¬ã‚¹
[ï¼­ï¼¬ï¼¢] ãƒ•ã‚£ãƒªãƒ¼ã‚º<1åŠ8> ãƒãƒ¼ãƒªãƒ³ã‚º

è¤‡é›‘ãªãƒãƒ³ãƒ‡ã‚£ã‚­ãƒ£ãƒƒãƒ—ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾å¿œ:
â€¢ 0åŠ2 â†’ 0.75å¤‰æ›
â€¢ 0/7 â†’ 0.7å¤‰æ›
â€¢ 1åŠ8 â†’ 1.75å¤‰æ›"></textarea>

            <div class="button-group">
                <button onclick="analyze()">
                    <span>ğŸ”</span> åˆ†æå®Ÿè¡Œ
                </button>
                <button onclick="clearAll()" class="btn-secondary">
                    <span>ğŸ—‘ï¸</span> ã‚¯ãƒªã‚¢
                </button>
                <button onclick="toggleDebug()" class="btn-info">
                    <span>ğŸ”§</span> <span id="debugButtonText">ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºON</span>
                </button>
                <button onclick="loadSample()" class="btn-secondary">
                    <span>ğŸ“‹</span> ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿
                </button>
            </div>
        </section>

        <div id="results" style="display: none;"></div>
    </div>

    <div class="shortcut-info">
        ğŸ’¡ <strong>Ctrl+Enter</strong>ã§åˆ†æå®Ÿè¡Œ
    </div>

    <!-- ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚·ã‚¹ãƒ†ãƒ  -->
    <script src="./js/error_tracking.js"></script>

    <script>
        let debugMode = false;

        const sampleData = `[ï¼­ï¼¬ï¼¢] ãƒ¤ãƒ³ã‚­ãƒ¼ã‚¹<2.0> ãƒ›ãƒ¯ã‚¤ãƒˆã‚½ãƒƒã‚¯ã‚¹
[ï¼­ï¼¬ï¼¢] ãƒ‰ã‚¸ãƒ£ãƒ¼ã‚¹<1.5> ãƒ‘ãƒ‰ãƒ¬ã‚¹
[ï¼­ï¼¬ï¼¢] ãƒ•ã‚£ãƒªãƒ¼ã‚º<1åŠ8> ãƒãƒ¼ãƒªãƒ³ã‚º`;

        async function analyze() {
            const text = document.getElementById('bettingText').value.trim();
            if (!text) {
                alert('âš ï¸ ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // è¨­å®šå€¤ã‚’å–å¾—
            const jpOdds = parseFloat(document.getElementById('jpOdds').value);
            const rakeback = parseFloat(document.getElementById('rakeback').value);

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’è¡¨ç¤º
            const progressSection = document.getElementById('progressSection');
            const resultsDiv = document.getElementById('results');

            progressSection.style.display = 'block';
            resultsDiv.style.display = 'none';

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ãƒªã‚»ãƒƒãƒˆ
            resetProgressBar();

            // ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            progressSection.scrollIntoView({ behavior: 'smooth' });

            try {
                const startTime = Date.now();

                // ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã«åˆ†æé–‹å§‹ã‚’è¨˜éŒ²
                if (window.BetValueErrorTracker) {
                    window.BetValueErrorTracker.logEvent('analysis_started', {
                        text_length: text.length,
                        jp_odds: jpOdds,
                        rakeback: rakeback,
                        timestamp: new Date().toISOString()
                    });
                }

                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹
                simulateProgress();

                const response = await fetch('/analyze_paste', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        paste_text: text,
                        sport_hint: "mixed",
                        jp_odds: jpOdds,
                        rakeback: rakeback
                    })
                });

                const processingTime = Date.now() - startTime;

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                }

                const results = await response.json();

                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’å®Œäº†çŠ¶æ…‹ã«
                completeProgress();

                // æˆåŠŸã‚’ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã«è¨˜éŒ²
                if (window.BetValueErrorTracker) {
                    window.BetValueErrorTracker.logEvent('analysis_completed', {
                        games_found: results.length,
                        processing_time: processingTime,
                        jp_odds: jpOdds,
                        rakeback: rakeback,
                        success: true
                    });
                }

                // çµæœè¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆï¼ˆå°‘ã—é…å»¶ã‚’å…¥ã‚Œã‚‹ï¼‰
                setTimeout(() => {
                    progressSection.style.display = 'none';
                    resultsDiv.style.display = 'block';
                    displayResults(results, processingTime);
                    resultsDiv.scrollIntoView({ behavior: 'smooth' });
                }, 500);

            } catch (error) {
                // ã‚¨ãƒ©ãƒ¼ã‚’ã‚¨ãƒ©ãƒ¼ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã«è¨˜éŒ²
                if (window.BetValueErrorTracker) {
                    window.BetValueErrorTracker.logError('Analysis failed', {
                        error_message: error.message,
                        text_length: text.length,
                        user_action: 'analyze_betting_text'
                    });
                }

                resultsDiv.innerHTML = `
                    <div class="form-section">
                        <div class="error">
                            <h3>âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</h3>
                            <p><strong>ã‚¨ãƒ©ãƒ¼å†…å®¹:</strong> ${error.message}</p>
                            <p><strong>å¯¾å‡¦æ–¹æ³•:</strong>
                            <br>â€¢ ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„
                            <br>â€¢ ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„
                            <br>â€¢ API KeyãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„</p>
                            <p><strong>ã‚¨ãƒ©ãƒ¼ã¯è‡ªå‹•çš„ã«å ±å‘Šã•ã‚Œã¾ã—ãŸã€‚</strong></p>
                        </div>
                    </div>
                `;
            }
        }

        function displayResults(results, processingTime) {
            const resultsDiv = document.getElementById('results');
            const gameCount = results.length;
            const avgConfidence = gameCount > 0 ?
                (results.reduce((sum, game) => sum + (game.match_confidence || 0), 0) / gameCount * 100).toFixed(1) : 0;

            let html = `
                <div class="form-section">
                    <div class="results-summary">
                        <h3>ğŸ“Š åˆ†æçµæœã‚µãƒãƒªãƒ¼</h3>
                        <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                            <div class="stat-item">
                                <span>ğŸ®</span>
                                <span><strong>${gameCount}</strong> ã‚²ãƒ¼ãƒ æ¤œå‡º</span>
                            </div>
                            <div class="stat-item">
                                <span>â±ï¸</span>
                                <span>å‡¦ç†æ™‚é–“: <strong>${processingTime}ms</strong></span>
                            </div>
                            <div class="stat-item">
                                <span>ğŸ¯</span>
                                <span>å¹³å‡ä¿¡é ¼åº¦: <strong>${avgConfidence}%</strong></span>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            if (gameCount === 0) {
                html += `
                    <div class="form-section">
                        <div style="text-align: center; color: #8b949e; padding: 20px;">
                            <h3>ğŸ¤” ã‚²ãƒ¼ãƒ ãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ</h3>
                            <p>ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã‚’ç¢ºèªã™ã‚‹ã‹ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚</p>
                        </div>
                    </div>
                `;
            }

            results.forEach((game, index) => {
                const evClass = getEVClass(game.ev_percentage);
                const evFormatted = formatEV(game.ev_percentage);
                const verdictClass = getVerdictClass(game.verdict);
                const verdictIcon = getVerdictIcon(game.verdict);

                html += `
                    <div class="game-card">
                        <div class="game-header">
                            <div class="game-teams">
                                <span>${game.team_a}</span>
                                <span class="vs">vs</span>
                                <span>${game.team_b}</span>
                            </div>
                            <div class="sport-badge">${(game.sport || 'Unknown').toUpperCase()}</div>
                        </div>

                        <div class="game-details">
                            <div class="detail-item">
                                <span class="detail-label">ğŸ“Š JP Line:</span>
                                <span class="detail-value">${game.jp_line || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ğŸ“ˆ Pinnacle Line:</span>
                                <span class="detail-value">${game.pinnacle_line || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">ğŸ¯ Fair Odds:</span>
                                <span class="detail-value">${game.fair_odds || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">â­ Fav Team:</span>
                                <span class="detail-value">${game.fav_team || 'N/A'}</span>
                            </div>
                        </div>

                        <!-- åŒæ–¹å‘ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°çµæœ -->
                        <div class="betting-analysis">
                            <h4 style="margin-bottom: 15px; color: #f0f6fc; font-size: 1.1rem;">ğŸ“Š åŒæ–¹å‘ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°åˆ†æ</h4>

                            <!-- æœ¬å‘½å´ (Favorite) -->
                            <div class="team-betting-section" style="margin-bottom: 15px; padding: 15px; background: #0d1117; border-radius: 6px; border-left: 3px solid #f79000;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                    <h5 style="color: #f79000; margin: 0; font-size: 1rem;">â­ æœ¬å‘½: ${game.fav_team || 'N/A'}</h5>
                                    <div class="verdict ${verdictClass}">
                                        <span>${verdictIcon}</span>
                                        <span>${game.verdict || 'N/A'}</span>
                                    </div>
                                </div>

                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 8px;">
                                    <div class="odds-item">
                                        <span style="color: #8b949e; font-size: 12px;">ğŸ“ˆ Pinnacle</span>
                                        <span style="color: #f0f6fc; font-weight: bold;">${game.pinnacle_line || 'N/A'}</span>
                                    </div>
                                    <div class="odds-item">
                                        <span style="color: #8b949e; font-size: 12px;">ğŸŒ æ—¥æœ¬å¼</span>
                                        <span style="color: #f0f6fc; font-weight: bold;">${game.jp_line || 'N/A'}</span>
                                    </div>
                                    <div class="odds-item">
                                        <span style="color: #8b949e; font-size: 12px;">ğŸ¯ Fair Odds</span>
                                        <span style="color: #f0f6fc; font-weight: bold;">${game.fair_odds || 'N/A'}</span>
                                    </div>
                                </div>

                                <div class="ev-value ${evClass}" style="font-size: 1.1rem;">
                                    <span>ğŸ’°</span>
                                    <span>æœŸå¾…å€¤: <strong>${evFormatted}%</strong></span>
                                    ${game.rakeback_applied > 0 ? `<span style="font-size: 0.85rem; color: #2ea043;">(+${(game.rakeback_applied * 100).toFixed(1)}% ãƒ¬ãƒ¼ã‚­ãƒãƒƒã‚¯)</span>` : ''}
                                </div>
                            </div>

                            ${game.ev_percentage_dog !== undefined && game.ev_percentage_dog !== null ? `
                                <!-- ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒƒã‚°å´ (Underdog) -->
                                <div class="team-betting-section" style="padding: 15px; background: #0d1117; border-radius: 6px; border-left: 3px solid #2ea043;">
                                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                        <h5 style="color: #2ea043; margin: 0; font-size: 1rem;">ğŸ• ã‚¢ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒƒã‚°: ${game.underdog_team || (game.fav_team === game.team_a ? game.team_b : game.team_a)}</h5>
                                        <div class="verdict ${getVerdictClass(game.verdict_dog)}">
                                            <span>${getVerdictIcon(game.verdict_dog)}</span>
                                            <span>${game.verdict_dog || 'N/A'}</span>
                                        </div>
                                    </div>

                                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin-bottom: 8px;">
                                        <div class="odds-item">
                                            <span style="color: #8b949e; font-size: 12px;">ğŸ“ˆ Pinnacle</span>
                                            <span style="color: #f0f6fc; font-weight: bold;">${game.pinnacle_line_dog || 'N/A'}</span>
                                        </div>
                                        <div class="odds-item">
                                            <span style="color: #8b949e; font-size: 12px;">ğŸŒ æ—¥æœ¬å¼</span>
                                            <span style="color: #f0f6fc; font-weight: bold;">${game.jp_line_dog || 'N/A'}</span>
                                        </div>
                                        <div class="odds-item">
                                            <span style="color: #8b949e; font-size: 12px;">ğŸ¯ Fair Odds</span>
                                            <span style="color: #f0f6fc; font-weight: bold;">${game.fair_odds_dog || 'N/A'}</span>
                                        </div>
                                    </div>

                                    <div class="ev-value ${getEVClass(game.ev_percentage_dog)}" style="font-size: 1.1rem;">
                                        <span>ğŸ’°</span>
                                        <span>æœŸå¾…å€¤: <strong>${formatEV(game.ev_percentage_dog)}%</strong></span>
                                        ${game.rakeback_applied > 0 ? `<span style="font-size: 0.85rem; color: #2ea043;">(+${(game.rakeback_applied * 100).toFixed(1)}% ãƒ¬ãƒ¼ã‚­ãƒãƒƒã‚¯)</span>` : ''}
                                    </div>
                                </div>
                            ` : ''}
                        </div>

                        <div class="confidence-section">
                            <div class="confidence-bar">
                                <div class="confidence-fill" style="width: ${(game.match_confidence || 0) * 100}%"></div>
                            </div>
                            <div class="confidence-text">
                                ğŸ” ãƒãƒƒãƒãƒ³ã‚°ä¿¡é ¼åº¦: ${Math.round((game.match_confidence || 0) * 100)}%
                            </div>
                        </div>

                        ${game.api_game_id ? `<div class="api-id">ğŸ”— API Game ID: ${game.api_game_id}</div>` : ''}

                        ${debugMode ? `
                            <div class="debug-info">
                                <h4>ğŸ”§ Debug Information</h4>
                                <div class="json-view">${JSON.stringify(game, null, 2)}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            });

            resultsDiv.innerHTML = html;
        }

        function getEVClass(ev) {
            if (!ev && ev !== 0) return 'ev-neutral';
            if (ev > 5) return 'ev-positive';
            if (ev > 2) return 'ev-positive';
            if (ev > 0) return 'ev-positive';
            if (ev < -2) return 'ev-negative';
            return 'ev-negative';
        }

        function getVerdictClass(verdict) {
            switch(verdict?.toLowerCase()) {
                case 'strong bet': return 'verdict-strong';
                case 'bet': return 'verdict-bet';
                case 'consider': return 'verdict-consider';
                case 'avoid': return 'verdict-avoid';
                default: return 'verdict-neutral';
            }
        }

        function formatEV(ev) {
            if (!ev && ev !== 0) return 'N/A';
            return ev > 0 ? `+${ev.toFixed(1)}` : ev.toFixed(1);
        }

        function getVerdictIcon(verdict) {
            switch(verdict?.toLowerCase()) {
                case 'strong bet': return 'ğŸ”¥';
                case 'bet': return 'âœ…';
                case 'consider': return 'ğŸ¤”';
                case 'avoid': return 'âŒ';
                default: return 'â“';
            }
        }

        function clearAll() {
            document.getElementById('bettingText').value = '';
            document.getElementById('results').style.display = 'none';
        }

        function toggleDebug() {
            debugMode = !debugMode;
            const buttonText = document.getElementById('debugButtonText');
            buttonText.textContent = debugMode ? 'ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºOFF' : 'ãƒ‡ãƒãƒƒã‚°è¡¨ç¤ºON';

            // çµæœãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å†æç”»
            const results = document.getElementById('results');
            if (results.style.display !== 'none') {
                // æœ€å¾Œã®åˆ†æçµæœã‚’å†è¡¨ç¤ºï¼ˆå®Ÿè£…ç°¡ç•¥åŒ–ã®ãŸã‚ã€å®Ÿéš›ã«ã¯å†åˆ†æãŒå¿…è¦ï¼‰
                console.log(`Debug mode: ${debugMode ? 'ON' : 'OFF'}`);
            }
        }

        function loadSample() {
            document.getElementById('bettingText').value = sampleData;
        }

        // ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: Ctrl+Enter ã§åˆ†æå®Ÿè¡Œ
        document.getElementById('bettingText').addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                analyze();
            }
        });

        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼èª¿æ•´
        document.getElementById('bettingText').addEventListener('focus', function() {
            if (this.value === '') {
                this.placeholder = 'è²¼ã‚Šä»˜ã‘ã¾ãŸã¯å…¥åŠ›ã—ã¦ãã ã•ã„... (Ctrl+Enterã§åˆ†æå®Ÿè¡Œ)';
            }
        });

        document.getElementById('bettingText').addEventListener('blur', function() {
            this.placeholder = 'ãƒ™ãƒƒãƒ†ã‚£ãƒ³ã‚°æƒ…å ±ã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„...\n\nä¾‹:\n[ï¼­ï¼¬ï¼¢] ãƒ¤ãƒ³ã‚­ãƒ¼ã‚¹<2.0> ãƒ›ãƒ¯ã‚¤ãƒˆã‚½ãƒƒã‚¯ã‚¹\n[ï¼­ï¼¬ï¼¢] ãƒ‰ã‚¸ãƒ£ãƒ¼ã‚¹<1.5> ãƒ‘ãƒ‰ãƒ¬ã‚¹  \n[ï¼­ï¼¬ï¼¢] ãƒ•ã‚£ãƒªãƒ¼ã‚º<1åŠ8> ãƒãƒ¼ãƒªãƒ³ã‚º\n\nè¤‡é›‘ãªãƒãƒ³ãƒ‡ã‚£ã‚­ãƒ£ãƒƒãƒ—ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¯¾å¿œ:\nâ€¢ 0åŠ2 â†’ 0.75å¤‰æ›\nâ€¢ 0/7 â†’ 0.7å¤‰æ›  \nâ€¢ 1åŠ8 â†’ 1.75å¤‰æ›';
        });

        // åˆæœŸåŒ–å®Œäº†
        console.log('ğŸ¯ BetValue Finder Personal Edition loaded successfully!');
        // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼é–¢é€£ã®é–¢æ•°
        function resetProgressBar() {
            const progressFill = document.getElementById('progressFill');
            const progressDetails = document.getElementById('progressDetails');
            const stages = ['parsing', 'api', 'matching', 'odds', 'ev', 'final'];

            progressFill.style.width = '0%';
            progressDetails.textContent = 'åˆ†æã‚’æº–å‚™ã—ã¦ã„ã¾ã™...';

            stages.forEach(stage => {
                const element = document.getElementById(`stage-${stage}`);
                element.classList.remove('active', 'completed');
            });
        }

        let progressInterval;
        function simulateProgress() {
            const stages = [
                { id: 'parsing', name: 'ãƒ‘ãƒ¼ã‚¹ä¸­...', duration: 500 },
                { id: 'api', name: 'APIå–å¾—ä¸­...', duration: 2000 },
                { id: 'matching', name: 'ãƒãƒƒãƒãƒ³ã‚°ä¸­...', duration: 1000 },
                { id: 'odds', name: 'ã‚ªãƒƒã‚ºå–å¾—ä¸­...', duration: 3000 },
                { id: 'ev', name: 'EVè¨ˆç®—ä¸­...', duration: 800 },
                { id: 'final', name: 'æœ€çµ‚åŒ–ä¸­...', duration: 300 }
            ];

            let currentStage = 0;
            const progressFill = document.getElementById('progressFill');
            const progressDetails = document.getElementById('progressDetails');

            function updateStage() {
                if (currentStage < stages.length) {
                    const stage = stages[currentStage];
                    const element = document.getElementById(`stage-${stage.id}`);

                    // å‰ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’å®Œäº†çŠ¶æ…‹ã«
                    if (currentStage > 0) {
                        const prevStage = stages[currentStage - 1];
                        const prevElement = document.getElementById(`stage-${prevStage.id}`);
                        prevElement.classList.remove('active');
                        prevElement.classList.add('completed');
                    }

                    // ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«
                    element.classList.add('active');

                    // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’æ›´æ–°
                    const progress = ((currentStage + 1) / stages.length) * 100;
                    progressFill.style.width = `${progress}%`;

                    // è©³ç´°ãƒ†ã‚­ã‚¹ãƒˆã‚’æ›´æ–°
                    progressDetails.textContent = stage.name;

                    currentStage++;
                    setTimeout(updateStage, stage.duration);
                }
            }

            updateStage();
        }

        function completeProgress() {
            const stages = ['parsing', 'api', 'matching', 'odds', 'ev', 'final'];
            const progressFill = document.getElementById('progressFill');
            const progressDetails = document.getElementById('progressDetails');

            // å…¨ã‚¹ãƒ†ãƒ¼ã‚¸ã‚’å®Œäº†çŠ¶æ…‹ã«
            stages.forEach(stage => {
                const element = document.getElementById(`stage-${stage}`);
                element.classList.remove('active');
                element.classList.add('completed');
            });

            // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’100%ã«
            progressFill.style.width = '100%';
            progressDetails.textContent = 'âœ… åˆ†æå®Œäº†ï¼çµæœã‚’è¡¨ç¤ºä¸­...';
        }

        console.log('ğŸ’¡ Enhanced Parser + Team Mapper (95.9%) + Pipeline Orchestrator ready');
        console.log('ğŸš€ Press Ctrl+Enter to analyze or click the analyze button');
        console.log('âš™ï¸ Rakeback & Progress Bar integrated');
    </script>
</body>
</html>